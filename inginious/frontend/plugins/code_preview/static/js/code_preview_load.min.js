function updateCodePreviewFiles(){$.get("/api/grader_generator/test_file_api",{course_id:getCourseId(),task_id:getTaskId()},function(e){let o=$("#code_preview_files");o.empty(),$.each(e,function(e,n){const i=n.complete_name.includes(".in")||n.complete_name.includes(".out");if(n.is_directory||i||"run"===n.complete_name)return;const a=$("<option>",{value:n.complete_name,text:n.complete_name});o.append(a)})},"json")}function addCodePreviewPair(){const e=$("#code_preview_languages > option:selected")[0].value,o=$("#code_preview_files > option:selected")[0].value;if("-1"===e)return;if(e in currentCodePreviewPairs)return currentCodePreviewPairs[e]=o,void $(`#code_preview_pairs_${e}`).val(o);const n=`\n    <div class="row" id="code-preview-${e}-row">\n        <div class="form-group col-xs-12">\n            <div class="col-xs-4">\n                <input class="form-control" value="${getLanguageName(e)}" readonly>\n            </div>\n            <div class="col-xs-4">\n                <input type=text class="form-control" id="code_preview_pairs_${e}" name="code_preview_pairs[${e}]" value="${o}" readonly />\n            </div>\n            <div class="col-xs-4" style="display: flex; height: 100%">\n                <button type="button" class="btn btn-danger btn-block" style="align-self: flex-end;"\n                onclick="removeCodePreviewPair('${e}');">${getRemoveMessage()}</button>\n        </div>\n    </div>\n    `;currentCodePreviewPairs[e]=o,$("#code_preview_files_pairs").append(n)}function removeCodePreviewPair(e){delete currentCodePreviewPairs[e],$(`#code-preview-${e}-row`).remove()}function updateCodePreviewLanguages(){const e=$(".checkbox_language"),o=$("#code_preview_languages");$(".code_preview_language").remove(),o.append(`<option class="code_preview_language" value="-1">${getSelectOneMessage()}</option>`);for(let n=0;n<e.length;n++)e[n].checked&&o.append(`<option class="code_preview_language"  \n                         value="${e[n].value}">${getLanguageName(e[n].value)}</option>`)}function loadCodePreviewToCodemirror(){let e="/api/code_preview/";is_lti()&&(e="/"+$("form#task").attr("action").split("/")[1]+e),$.get(e,{task_id:getTaskId(),course_id:getCourseId(),language:getInginiousLanguageForProblemId(getProblemId())}).done(function(e){Object.keys(codeEditors).forEach(o=>{codeEditors[o].setValue(e)})})}function monkeyPatchOnChangeLanguageDropdown(){const e=onChangeLanguageDropdown;onChangeLanguageDropdown=((o,n)=>{e(o,n),loadCodePreviewToCodemirror()})}$("a[data-toggle='tab'][href='#tab_code_preview']").on("show.bs.tab",function(e){updateCodePreviewLanguages(),updateCodePreviewFiles();const o=$("#environment").val();["HDL","multiple_languages"].includes(o)?($("#code_preview button").prop("disabled",!1),$("#code_preview select").prop("disabled",!1)):($("#code_preview button").prop("disabled",!0),$("#code_preview select").prop("disabled",!0))}),jQuery(document).ready(function(){"undefined"==typeof getTaskEnvironment||!["multiple_languages","HDL","Data Science"].includes(getTaskEnvironment())||location.href.includes("submission")||document.referrer.includes("submission")||(monkeyPatchOnChangeLanguageDropdown(),loadCodePreviewToCodemirror())});