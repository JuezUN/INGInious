const LANGUAGES={java7:"java",java8:"java",cpp:"cpp",cpp11:"cpp",c:"c",c11:"c",python3:"python",vhdl:"vhdl",verilog:"verilog"};class CodeField{constructor(e,t){this.environmentType=environmentType(),this.multilangCodeArea=$(`#${e}`),this.notebookDiv=$(`#${t}`),this.displayCodeArea()}displayCodeArea(){this.isNotebook()?this.getNotebookCodeDataAndRender():this.showMultiLangCodeArea()}isNotebook(){return"Notebook"===this.environmentType}getNotebookCodeDataAndRender(){const e=this;$.ajax({url:getURLSubmissionCode(),method:"GET",dataType:"json",success:function(t){render_notebook(t,e.notebookDiv)}})}showMultiLangCodeArea(){this.multilangCodeArea.parent().show();const e=LANGUAGES[this.multilangCodeArea.data("language")];registerCodeEditor(this.multilangCodeArea.get(0),e,20).setOption("readOnly","nocursor")}}class MessageBox{constructor(e,t,s,i=!0){this.divElement=document.getElementById(e),this.textContent=t,this.type=s,this.dismissible=i,this.generateHtmlCode(),this.displayBoxMessage()}generateHtmlCode(){let e='<div class="alert ';this.dismissible&&(e+="alert-dismissible "),e+=`alert-${this.type}" role="alert">`,this.dismissible||(e+='<button id=\'close-b\' type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'),e+=this.textContent+"</div>",this.code=e}displayBoxMessage(){this.divElement.innerHTML+=this.code,this.divElement.style.display="block",this.dismissible&&this.doDisappearEffect()}doDisappearEffect(){let e=1;const t=this.divElement,s=setInterval(function(){e<=.1&&(t.style.display="none",clearInterval(s),t.innerHTML=""),t.style.opacity=e,t.style.filter="alpha(opacity="+100*e+")",e-=.05*e},100)}deleteCloseButton(){document.getElementById("close-b").remove()}}class Rubric{constructor(){this.score=0,this.matrix=[],this.matrixLength=5,this.classMarkerId="box1",this.scoreTextId="output",this.formMatrixRespectRubric(),this.addListeners()}formMatrixRespectRubric(){for(let e=0;e<this.matrixLength;e++){this.matrix[e]=[];for(let t=0;t<this.matrixLength;t++){let s=new MatrixField(e,t);this.matrix[e][t]=document.getElementById(s.fieldId)}}}addListeners(){for(let e=0;e<this.matrixLength;e++)for(let t=0;t<this.matrixLength;t++){let s=new MatrixField(e,t);this.addSelectFunction(s),this.addDeselectFunction(s),this.changeCursorToPointerWhenIsOver(s),this.changeCursorToDefaultWhenIsOut(s)}}addSelectFunction(e){const t=this;this.matrix[e.iIndex][e.jIndex].addEventListener("click",function(){t.removeSelectionOnRow(e.iIndex),t.addMarkerClass(e.fieldId),t.updateScore(e.jIndex)})}addDeselectFunction(e){const t=this;this.matrix[e.iIndex][e.jIndex].addEventListener("dblclick",function(){t.removeMarkerClass(e.fieldId),t.updateScore(e.jIndex,!1)})}changeCursorToPointerWhenIsOver(e){this.matrix[e.iIndex][e.jIndex].addEventListener("mouseover",function(){document.body.style.cursor="pointer"})}changeCursorToDefaultWhenIsOut(e){this.matrix[e.iIndex][e.jIndex].addEventListener("mouseout",function(){document.body.style.cursor="default"})}removeSelectionOnRow(e){let t=this.getSelectionOnRow(e);null!==t&&(this.removeMarkerClass(t.fieldId),this.updateScore(t.jIndex,!1))}getSelectionOnRow(e){for(let t=0;t<this.matrixLength;t++){let s=new MatrixField(e,t);if(this.isFieldSelected(s))return s}return null}addMarkerClass(e){document.getElementById(e).classList.add(this.classMarkerId)}removeMarkerClass(e){document.getElementById(e).classList.remove(this.classMarkerId)}isFieldSelected(e){return this.matrix[e.iIndex][e.jIndex].classList.contains(this.classMarkerId)}updateScoreText(){document.getElementById(this.scoreTextId).innerHTML=this.score.toFixed(1)}updateScore(e,t=!0){t?this.score+=.2*(e+1):this.score-=.2*(e+1),this.updateScoreText()}getSelectedFieldIds(){let e=[];for(let t=0;t<this.matrixLength;t++){let s=this.getSelectionOnRow(t);null!==s&&e.push(s.fieldId)}return e}loadSelectedFields(e){const t=this;e.forEach(function(e){t.addMarkerClass(e),t.updateScore(parseInt(e[2],10))})}}class MatrixField{constructor(e,t){this.iIndex=e,this.jIndex=t}get fieldId(){return`${this.iIndex}-${this.jIndex}`}}const RESPONSE_FIELD_ID="gradeEditSubmitStatus",FEEDBACK_FIELD_ID="taskAlert",TASK_NAME="taskName",TASK_DESCRIPTION_TEXT_ID="taskDescription",CODE_AREA_ID="codemirrorTextArea",NOTEBOOK_CODE_AREA_ID="notebookHolder",SAVE_BUTTON_ID="saveButton",COMMENTS_TEXT_AREA_ID="textComments";function save(e){const t=document.getElementById(COMMENTS_TEXT_AREA_ID);jQuery.ajax({success:function(e){new MessageBox(RESPONSE_FIELD_ID,"Submission graded and stored","info")},method:"POST",data:{manual_grade:e.score.toFixed(1),comment:t.value,rubric:JSON.stringify(e.getSelectedFieldIds())},error:function(e,t,s){new MessageBox(RESPONSE_FIELD_ID,"Something went wrong","danger")}})}function loadFeedBack(){const e=getHtmlCodeForFeedback(),t=getTextBoxTypeBasedOnResult();new MessageBox(FEEDBACK_FIELD_ID,e,t,!1).deleteCloseButton()}function addToggleBehaviorToProblemDescription(){$(`#${TASK_NAME}`).click(function(){$(`#${TASK_DESCRIPTION_TEXT_ID}`).collapse("toggle")})}function addSaveFunctionToSaveButton(e){$(`#${SAVE_BUTTON_ID}`).click(function(){save(e)})}jQuery(document).ready(function(){new CodeField(CODE_AREA_ID,"notebookHolder");const e=new Rubric;let t=rubricStatus();t=JSON.parse(t.replace(/&quot;/g,'"')),e.loadSelectedFields(t),loadFeedBack(),addToggleBehaviorToProblemDescription(),addSaveFunctionToSaveButton(e),window.save=save});