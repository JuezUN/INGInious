class MessageBox{constructor(e,t,o,a=!0){this.divElement=document.getElementById(e),this.textContent=t,this.type=o,this.dismissible=a,this.generateHtmlCode(),this.displayBoxMessage()}generateHtmlCode(){let e='<div class="alert ';this.dismissible&&(e+="alert-dismissible "),e+=`alert-${this.type}" role="alert">`,this.dismissible||(e+='<button id=\'close-b\' type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'),e+=this.textContent+"</div>",this.code=e}displayBoxMessage(){this.divElement.innerHTML+=this.code,this.divElement.style.display="block",this.dismissible&&this.doDisappearEffect()}doDisappearEffect(){let e=1;const t=this.divElement,o=setInterval(function(){e<=.1&&(t.style.display="none",clearInterval(o),t.innerHTML=""),t.style.opacity=e,t.style.filter="alpha(opacity="+100*e+")",e-=.05*e},100)}deleteCloseButton(){document.getElementById("close-b").remove()}}const DOWNLOAD_CSV_BTN_ID="download_csv",RESULT_INFO_AREA_ID="information_area";function getManualScoringInfo(e){return $.get(`/api/manual_scoring/${e}`,function(e){exportCSVFile(e,"test")},"json").fail(function(){new MessageBox(RESULT_INFO_AREA_ID,"Error getting the information. Try later","danger",!1)})}function exportCSVFile(e,t){const o=`${t}.csv`,a="data:text/csv;charset=utf-8,"+Papa.unparse(e),i=encodeURI(a),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",o),document.body.appendChild(s),s.click(),s.remove()}function addListenerToDownloadButton(){const e=getCourseId();$(`#${DOWNLOAD_CSV_BTN_ID}`).click(function(){getManualScoringInfo(e)})}function displaySaveRubricAlertError(e){const t=$("#save_rubric_alert");t.prop("class","alert alert-danger"),"string"!=typeof e?t.text("Something went wrong while saving the rubric. Please try again."):t.text(e),t.prop("hidden",!1)}function displaySaveRubricAlertSuccess(e){const t=$("#save_rubric_alert");t.prop("class","alert alert-success"),t.text(e),t.prop("hidden",!1)}function preventModalToBeClosed(){$("#upload_custom_rubric_modal").modal({backdrop:"static",keyboard:!1}),$("#upload_custom_rubric_modal button[data-dismiss=modal]").each(function(){$(this).prop("disabled",!0)})}function makeModalClosable(){$("#upload_custom_rubric_modal").modal({backdrop:"",keyboard:!0}),$("#upload_custom_rubric_modal button[data-dismiss=modal]").each(function(){$(this).prop("disabled",!1)}),$("#upload_custom_rubric_modal").scrollTop(0)}function onSubmitSaveRubric(){$("form#upload_rubric_file").submit(function(e){e.preventDefault();const t=$("#rubric_file").prop("files")[0];if(void 0===t)displaySaveRubricAlertError("Please select a file before submitting it.");else if(/(\.json)$/i.exec(t.name)){const e=new FormData;e.append("file",t),e.append("course",getCourseId()),$.ajax({url:"/api/manual_scoring/upload_custom_rubric",method:"POST",dataType:"json",data:e,mimeType:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){$("#submit_save_rubric").prop("disabled",!0),preventModalToBeClosed(),alert("Do you want to upload this rubric?")},success:function(e){makeModalClosable(),"error"===e.status?displaySaveRubricAlertError(e.text):displaySaveRubricAlertSuccess(e.text),$("#submit_save_rubric").prop("disabled",!1)},error:function(e){displaySaveRubricAlertError(e.text),makeModalClosable(),$("#submit_save_rubric").prop("disabled",!1)},complete:()=>{$("#rubric_file").val("")}})}else displaySaveRubricAlertError("The inserted file should be a .json file.")})}function closeModalEvent(){$("#upload_custom_rubric_modal").on("hidden.bs.modal",function(){window.location.reload()})}function setupDownloadRubric(){const e=encodeURI("data:text/json;charset=utf-8,"+getRubric()),t=$("#download_rubric");t.attr("href",e),t.attr("download","default_rubric.json")}jQuery(document).ready(function(){addListenerToDownloadButton(),onSubmitSaveRubric(),closeModalEvent(),setupDownloadRubric()});