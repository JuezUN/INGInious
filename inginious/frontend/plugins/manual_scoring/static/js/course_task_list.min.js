const DOWNLOAD_CSV_BTN_ID="download_csv",RESULT_INFO_AREA_ID="information_area";function getManualScoringInfo(e){return $.get(`/api/manual_scoring/${e}`,function(e){exportCSVFile(e,"test")},"json").fail(function(){new MessageBox(RESULT_INFO_AREA_ID,"Error getting the information. Try later","danger",!1)})}function exportCSVFile(e,o){const t=`${o}.csv`,a="data:text/csv;charset=utf-8,"+Papa.unparse(e),r=encodeURI(a),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",t),document.body.appendChild(i),i.click(),i.remove()}function addListenerToDownloadButton(){const e=getCourseId();$(`#${DOWNLOAD_CSV_BTN_ID}`).click(function(){getManualScoringInfo(e)})}function displaySaveRubricAlertError(e){const o=$("#save_rubric_alert");o.prop("class","alert alert-danger"),"string"!=typeof e?o.text("Something went wrong while saving the rubric. Please try again."):o.text(e),o.prop("hidden",!1)}function displaySaveRubricAlertSuccess(e){const o=$("#save_rubric_alert");o.prop("class","alert alert-success"),o.text(e),o.prop("hidden",!1)}function preventModalToBeClosed(){$("#upload_custom_rubric_modal").modal({backdrop:"static",keyboard:!1}),$("#upload_custom_rubric_modal button[data-dismiss=modal]").each(function(){$(this).prop("disabled",!0)})}function makeModalClosable(){$("#upload_custom_rubric_modal").modal({backdrop:"",keyboard:!0}),$("#upload_custom_rubric_modal button[data-dismiss=modal]").each(function(){$(this).prop("disabled",!1)}),$("#upload_custom_rubric_modal").scrollTop(0)}function onSubmitSaveRubric(){$("form#upload_rubric_file").submit(function(e){e.preventDefault();const o=$("#rubric_file").prop("files")[0];if(void 0===o)displaySaveRubricAlertError("Please select a file before submitting it.");else if(/(\.json)$/i.exec(o.name)){const e=new FormData;e.append("file",o),e.append("course",getCourseId()),$.ajax({url:"/api/manual_scoring/upload_custom_rubric",method:"POST",dataType:"json",data:e,mimeType:"multipart/form-data",processData:!1,contentType:!1,beforeSend:function(){$("#submit_save_rubric").prop("disabled",!0),preventModalToBeClosed(),alert("Do you want to upload this rubric?")},success:function(e){makeModalClosable(),"error"===e.status?displaySaveRubricAlertError(e.text):displaySaveRubricAlertSuccess(e.text),$("#submit_save_rubric").prop("disabled",!1)},error:function(e){displaySaveRubricAlertError(e.text),makeModalClosable(),$("#submit_save_rubric").prop("disabled",!1)},complete:()=>{$("#rubric_file").val("")}})}else displaySaveRubricAlertError("The inserted file should be a .json file.")})}function closeModalEvent(){$("#upload_custom_rubric_modal").on("hidden.bs.modal",function(){window.location.reload()})}function setupDownloadRubric(){const e=encodeURI("data:text/json;charset=utf-8,"+getRubric()),o=$("#download_rubric");o.attr("href",e),o.attr("download","default_rubric.json")}jQuery(document).ready(function(){addListenerToDownloadButton(),onSubmitSaveRubric(),closeModalEvent(),setupDownloadRubric()});