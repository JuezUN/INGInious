var PythonTutor=function(){function t(t,e){this.defaultVisualServer=getDefaultVisualServerURL(),this.javaVisualServer="https://cscircles.cemc.uwaterloo.ca/",this.problemId=t,this.code=codeEditors[t].getValue(),"plain"==e&&(e=getLanguageForProblemId(this.problemId)),"python"==e&&(e=getInginiousLanguageForProblemId(this.problemId)),this.language=e,this.input=document.getElementById("custominput-"+this.problemId).value}return t.prototype.visualize=function(){var t=this.createIFrameFromCode();this.showIFrameIntoModal(t)},t.prototype.createIFrameFromCode=function(){var t=document.createElement("iframe");return t.src=this.generateVisualizerUrl(),t.height="400px",t.width="100%",t.frameborder="0",t},t.prototype.showIFrameIntoModal=function(t){var e=document.getElementById("modal-"+this.problemId).getElementsByClassName("modal-body")[0];$(e).empty(),e.innerHTML="Plase wait while we excecute your code, this may take up to 10 seconds",e.appendChild(t)},t.prototype.generateVisualizerUrl=function(){return"java"==this.language?this.generateJavaUrl():this.generateGenericUrl()},t.prototype.generateJavaUrl=function(){var t={user_script:this.code,options:{showStringsAsValues:!0,showAllFields:!1},args:[],stdin:this.input};return this.serverResource()+window.encodeURIComponent(JSON.stringify(t))+"&cumulative=false&heapPrimitives=false&drawParentPointers=false&textReferences=false&showOnlyOutputs=false&py=3&curInstr=0&resizeContainer=true&highlightLines=true&rightStdout=true&codeDivHeight=450&codeDivWidth=500"},t.prototype.generateGenericUrl=function(){var t=window.encodeURIComponent(this.code);return this.serverResource()+t+"&mode=edit&py="+this.languageURIName()+"&codeDivHeight=450&codeDivWidth=500&rawInputLstJSON="+this.encodedInputArray()},t.prototype.serverResource=function(){return"java"===this.language?this.javaVisualServer+"java_visualize/iframe-embed.html?faking_cpp=false#data=":this.defaultVisualServer+"iframe-embed.html#code="},t.prototype.languageURIName=function(){return"javascript"==this.language?"js":"python2"==this.language?"2":"python3"==this.language?"3":this.language},t.prototype.encodedInputArray=function(){var t=this.input.split("\n");return window.encodeURIComponent(JSON.stringify(t))},t}();function visualizeCode(t,e){var o=new PythonTutor(e,t);let n="/api/analytics/";is_lti()&&(n="/"+$("form#task").attr("action").split("/")[1]+n),$.post(n,{service:{key:"python_tutor",name:"Python tutor"},course_id:getCourseId()}),o.visualize()}function convertInginiousLanguageToLinter(t){return{java7:"java",java8:"java",js:"javascript",cpp:"cpp",cpp11:"cpp",c:"c",c11:"c",python2:"python2",python3:"python3",ruby:"ruby"}[t]}function webLinter(t,e,o,n){var r=convertInginiousLanguageToLinter(n.getOption("inginiousLanguage")),s=getLinterServerURL()+r;$.post(s,{code:t},function(t,o){var n=JSON.parse(t);e(n)})}function getTaskIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-1]}function getCourseIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-2]}function displayCustomTestAlertError(t){displayTaskStudentAlertWithProblems(t,"danger")}function displayTimeOutAlert(t){displayTaskStudentAlertWithProblems(t,"warning")}function displayOverflowAlert(t){displayTaskStudentAlertWithProblems(t,"danger")}function displaySuccessAlert(t){displayTaskStudentAlertWithProblems(t,"success")}function displayCustomInputResults(t,e=null,o=null){if("status"in t&&"done"===t.status){if("result"in t){const o=t.result;if(e){const o=$("<span/>").addClass("stdout-text").text(t.stdout),n=$("<span/>").addClass("stderr-text").text(t.stderr);e.append(o),e.append(n)}"failed"===o?displayCustomTestAlertError(t):"timeout"===o?displayTimeOutAlert(t):"overflow"===o?displayOverflowAlert(t):"success"===o?displaySuccessAlert(t):displayCustomTestAlertError(t)}}else"status"in t&&"error"===t.status?(e&&e.html(o),"timeout"===t.result?(t.text="Your submission timed out.",displayTimeOutAlert(t)):displayCustomTestAlertError(t)):(e&&e.html(o),displayCustomTestAlertError({}))}function waitForCustomTest(t){setTimeout(()=>{let e="/api/custom_input_notebook/";is_lti()&&(e="/"+$("form#task").attr("action").split("/")[1]+e),$.get(e,{custom_test_id:t}).done(e=>{"status"in(e=JSON.parse(e))&&"waiting"===e.status?(displayTaskLoadingAlert(e,null),waitForCustomTest(t)):"status"in e&&"done"===e.status?(displayCustomInputResults(e),unblurTaskForm()):(displayCustomTestAlertError(e),unblurTaskForm())}).fail(t=>{const e=JSON.parse(t.responseJSON||"{}");"status"in e&&"error"===e.status&&"text"in e?displayCustomTestAlertError(e):displayCustomTestAlertError({text:"An error occurred while running the custom tests. Please try again or submitting to know the results."}),unblurTaskForm()})},1e3)}function apiTestNotebookRequest(t,e){if(!taskFormValid())return;$("html, body").animate({scrollTop:$("#task_alert").offset().top-100},200),blurTaskForm(),sendTestNotebookAnalytics();let o="/api/custom_input_notebook/";is_lti()&&(o="/"+$("form#task").attr("action").split("/")[1]+o),$.ajax({url:o,method:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:t=>{"status"in(t=JSON.parse(t))&&"error"===t.status?(displayCustomTestAlertError(t),unblurTaskForm()):(displayTaskLoadingAlert(t,null),waitForCustomTest(t.custom_test_id))},error:t=>{const e=JSON.parse(t.responseJSON||"{}");"status"in e&&"error"===e.status&&"text"in e?displayCustomTestAlertError(e):displayCustomTestAlertError({text:"An error occurred while running the custom tests. The tests likely took more time than expect or check your session has not expired. Please try again or try submitting to know the results."}),unblurTaskForm()}})}function apiCustomInputRequest(t,e){const o=$("#customoutput-"+t),n="<span class='placeholder-text'>Your output goes here</span>";if(!taskFormValid())return;let r="/api/custom_input/";is_lti()&&(r="/"+$("form#task").attr("action").split("/")[1]+r);blurTaskForm(),resetAlerts(),o.html("Running..."),sendCustomInputAnalytics(),$.ajax({url:r,method:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:function(t){t=JSON.parse(t),o.empty(),displayCustomInputResults(t,o,n),unblurTaskForm()},error:function(t){unblurTaskForm(),o.html(n)}})}function runCustomTest(t,e="multilang"){const o=new FormData($("form#task")[0]);o.set("submit_action","customtest"),o.set("courseid",getCourseId()),o.set("taskid",getTaskId()),"multilang"===e?apiCustomInputRequest(t,o):"Notebook"===e&&(o.set(`${t}/input`,o.getAll(`${t}/custom_tests`)),apiTestNotebookRequest(t,o))}function sendCustomInputAnalytics(){let t="/api/analytics/";is_lti()&&(t="/"+$("form#task").attr("action").split("/")[1]+t),$.post(t,{service:{key:"custom_input",name:"Custom input"},course_id:getCourseId()})}function sendTestNotebookAnalytics(){let t="/api/analytics/";is_lti()&&(t="/"+$("form#task").attr("action").split("/")[1]+t),$.post(t,{service:{key:"custom_input_notebook",name:"Custom input notebook"},course_id:getCourseId()})}!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.registerHelper("lint","python",webLinter),t.registerHelper("lint","text/x-java",webLinter),t.registerHelper("lint","text/x-c++src",webLinter),t.registerHelper("lint","text/x-csrc",webLinter)}),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";const e="CodeMirror-lint-markers";function o(t){t.parentNode&&t.parentNode.removeChild(t)}function n(e,n,r){let s=function(e,o){const n=document.createElement("div");function r(e){if(!n.parentNode)return t.off(document,"mousemove",r);n.style.top=Math.max(0,e.clientY-n.offsetHeight-5)+"px",n.style.left=e.clientX+5+"px"}return n.className="CodeMirror-lint-tooltip",n.appendChild(o.cloneNode(!0)),document.body.appendChild(n),t.on(document,"mousemove",r),r(e),null!=n.style.opacity&&(n.style.opacity=1),n}(e,n);function i(){var e;t.off(r,"mouseout",i),s&&((e=s).parentNode&&(null==e.style.opacity&&o(e),e.style.opacity=0,setTimeout(function(){o(e)},600)),s=null)}const a=setInterval(function(){if(s)for(let t=r;;t=t.parentNode){if(t&&11===t.nodeType&&(t=t.host),t===document.body)return;if(!t){i();break}}if(!s)return clearInterval(a)},400);t.on(r,"mouseout",i)}function r(t,e,o){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=o,this.onMouseOver=function(e){!function(t,e){const o=e.target||e.srcElement;if(!/\bCodeMirror-lint-mark-/.test(o.className))return;const r=o.getBoundingClientRect(),s=(r.left+r.right)/2,i=(r.top+r.bottom)/2,u=t.findMarksAt(t.coordsChar({left:s,top:i},"client")),l=[];for(let t=0;t<u.length;++t){const e=u[t].__annotation;e&&l.push(e)}l.length&&function(t,e){const o=e.target||e.srcElement,r=document.createDocumentFragment();for(let e=0;e<t.length;e++){let o=t[e];r.appendChild(a(o))}n(e,r,o)}(l,e)}(t,e)},this.waitingFor=0}function s(t){const o=t.state.lint;o.hasGutter&&t.clearGutter(e);for(let t=0;t<o.marked.length;++t)o.marked[t].clear();o.marked.length=0}function i(e,o,r,s){let i=document.createElement("div"),a=i;return i.className="CodeMirror-lint-marker-"+o,r&&((a=i.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),!1!==s&&t.on(a,"mouseover",function(t){n(t,e,a)}),i}function a(t){let e=t.severity;e||(e="error");const o=document.createElement("div");return o.className="CodeMirror-lint-message-"+e,void 0!==t.messageHTML?o.innerHTML=t.messageHTML:o.appendChild(document.createTextNode(t.message)),o}function u(e){const o=e.state.lint.options,n=o.options||o,r=o.getAnnotations||e.getHelper(t.Pos(0,0),"lint");if(r)if(o.async||r.async)!function(e,o,n){const r=e.state.lint;let s=++r.waitingFor;function i(){s=-1,e.off("change",i)}e.on("change",i),o(e.getValue(),function(o,n){e.off("change",i),r.waitingFor===s&&(n&&o instanceof t&&(o=n),e.operation(function(){l(e,o)}))},n,e)}(e,r,n);else{const t=r(e.getValue(),n,e);if(!t)return;t.then?t.then(function(t){e.operation(function(){l(e,t)})}):e.operation(function(){l(e,t)})}}function l(t,o){s(t);const n=t.state.lint,r=n.options,u=function(t){const e=[];for(let o=0;o<t.length;++o){const n=t[o],r=n.from.line;(e[r]||(e[r]=[])).push(n)}return e}(o);for(let o=0;o<u.length;++o){const s=u[o];if(!s)continue;let p=null;const d=n.hasGutter&&document.createDocumentFragment();for(let e=0;e<s.length;++e){let o=s[e],i=o.severity;i||(i="error"),c=i,p="error"===(l=p)?l:c,r.formatAnnotation&&(o=r.formatAnnotation(o)),n.hasGutter&&d.appendChild(a(o)),o.to&&n.marked.push(t.markText(o.from,o.to,{className:"CodeMirror-lint-mark-"+i,__annotation:o}))}n.hasGutter&&t.setGutterMarker(o,e,i(d,p,s.length>1,n.options.tooltips))}var l,c;r.onUpdateLinting&&r.onUpdateLinting(o,u,t)}function c(t){const e=t.state.lint;e&&(e.options.lintOnChange?(clearTimeout(e.timeout),e.timeout=setTimeout(function(){u(t)},e.options.delay||1e3)):s(t))}t.defineOption("lint",!1,function(o,n,i){if(i&&i!==t.Init&&(s(o),o.on("change",c),t.off(o.getWrapperElement(),"mouseover",o.state.lint.onMouseOver),clearTimeout(o.state.lint.timeout),delete o.state.lint),n){const s=o.getOption("gutters");let i=!1;for(let t=0;t<s.length;++t)s[t]===e&&(i=!0);const u=o.state.lint=new r(o,(a=n)instanceof Function?{getAnnotations:a}:(a&&!0!==a||(a={}),a),i);o.on("change",c),!1!==u.options.tooltips&&"gutter"!==u.options.tooltips&&t.on(o.getWrapperElement(),"mouseover",u.onMouseOver)}var a}),t.defineExtension("performLint",function(){this.state.lint&&u(this)})}),$(document).ready(function(){let t=null;$("#select_test").change(function(e){$(this).val().length>3?$(this).val(t):t=$(this).val()})});