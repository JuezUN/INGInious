var PythonTutor=function(){function t(t,e){this.defaultVisualServer=getDefaultVisualServerURL(),this.javaVisualServer="https://cscircles.cemc.uwaterloo.ca/",this.problemId=t,this.code=codeEditors[t].getValue(),"plain"==e&&(e=getLanguageForProblemId(this.problemId)),"python"==e&&(e=getInginiousLanguageForProblemId(this.problemId)),this.language=e,this.input=document.getElementById("custominput-"+this.problemId).value}return t.prototype.visualize=function(){var t=this.createIFrameFromCode();this.showIFrameIntoModal(t)},t.prototype.createIFrameFromCode=function(){var t=document.createElement("iframe");return t.src=this.generateVisualizerUrl(),t.height="400px",t.width="100%",t.frameborder="0",t},t.prototype.showIFrameIntoModal=function(t){var e=document.getElementById("modal-"+this.problemId).getElementsByClassName("modal-body")[0];$(e).empty(),e.innerHTML="Plase wait while we excecute your code, this may take up to 10 seconds",e.appendChild(t)},t.prototype.generateVisualizerUrl=function(){return"java"==this.language?this.generateJavaUrl():this.generateGenericUrl()},t.prototype.generateJavaUrl=function(){var t={user_script:this.code,options:{showStringsAsValues:!0,showAllFields:!1},args:[],stdin:this.input};return this.serverResource()+window.encodeURIComponent(JSON.stringify(t))+"&cumulative=false&heapPrimitives=false&drawParentPointers=false&textReferences=false&showOnlyOutputs=false&py=3&curInstr=0&resizeContainer=true&highlightLines=true&rightStdout=true&codeDivHeight=450&codeDivWidth=500"},t.prototype.generateGenericUrl=function(){var t=window.encodeURIComponent(this.code);return this.serverResource()+t+"&mode=edit&py="+this.languageURIName()+"&codeDivHeight=450&codeDivWidth=500&rawInputLstJSON="+this.encodedInputArray()},t.prototype.serverResource=function(){return"java"===this.language?this.javaVisualServer+"java_visualize/iframe-embed.html?faking_cpp=false#data=":this.defaultVisualServer+"iframe-embed.html#code="},t.prototype.languageURIName=function(){return"javascript"==this.language?"js":"python2"==this.language?"2":"python3"==this.language?"3":this.language},t.prototype.encodedInputArray=function(){var t=this.input.split("\n");return window.encodeURIComponent(JSON.stringify(t))},t}();function visualizeCode(t,e){var n=new PythonTutor(e,t);$.post("/api/analytics/",{service:{key:"python_tutor",name:"Python tutor"},course_id:getCourseId()}),n.visualize()}function convertInginiousLanguageToLinter(t){return{java7:"java",java8:"java",js:"javascript",cpp:"cpp",cpp11:"cpp",c:"c",c11:"c",python2:"python2",python3:"python3",ruby:"ruby"}[t]}function webLinter(t,e,n,o){var r=convertInginiousLanguageToLinter(o.getOption("inginiousLanguage")),i=getLinterServerURL()+r;$.post(i,{code:t},function(t,n){var o=JSON.parse(t);e(o)})}function getTaskIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-1]}function getCourseIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-2]}function getCurrentPageName(){return window.location.pathname.split("/")[1]}function displayCustomTestAlertError(t){displayTaskStudentAlertWithProblems(t,"danger")}function displayTimeOutAlert(t){displayTaskStudentAlertWithProblems(t,"warning")}function displayOverflowAlert(t){displayTaskStudentAlertWithProblems(t,"danger")}function apiCustomInputRequest(t,e){let n=$("#customoutput-"+t),o="<span class='placeholder-text'>Your output goes here</span>";blurTaskForm(),resetAlerts(),n.html("Running..."),$.ajax({url:"/api/multilang/",method:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:function(t){if(t=JSON.parse(t),n.empty(),"status"in t&&"done"===t.status){if("result"in t){let e=t.result,o=$("<span/>").addClass("stdout-text").text(t.stdout),r=$("<span/>").addClass("stderr-text").text(t.stderr);n.append(o),n.append(r),"failed"===e?displayCustomTestAlertError(t):"timeout"===e?displayTimeOutAlert(t):"overflow"===e?displayOverflowAlert(t):"success"!==e&&displayCustomTestAlertError(t)}}else"status"in t&&"error"===t.status?(n.html(o),"timeout"===t.result?(t.text="Your code did not finished. Your code TIMED OUT.",displayTimeOutAlert(t)):displayCustomTestAlertError(t)):(n.html(o),displayCustomTestAlertError({}));unblurTaskForm()},error:function(t){unblurTaskForm(),n.html(o)}})}function runCustomTest(t){let e=new FormData($("form#task")[0]);e.set("submit_action","customtest"),"course"===getCurrentPageName()?(e.set("courseid",getCourseIdFromUrl()),e.set("taskid",getTaskIdFromUrl()),apiCustomInputRequest(t,e)):"submission"===getCurrentPageName()?$.get("/api/multilang/",{submission:getTaskIdFromUrl()},n=>{e.set("courseid",n.courseid),e.set("taskid",n.taskid),apiCustomInputRequest(t,e)}):is_lti()&&(e.set("courseid",getCourseId()),e.set("taskid",getTaskId()),apiCustomInputRequest(t,e)),$.post("/api/analytics/",{service:{key:"custom_input",name:"Custom input"},course_id:getCourseId()})}!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.registerHelper("lint","python",webLinter),t.registerHelper("lint","text/x-java",webLinter),t.registerHelper("lint","text/x-c++src",webLinter),t.registerHelper("lint","text/x-csrc",webLinter)}),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";const e="CodeMirror-lint-markers";function n(t){t.parentNode&&t.parentNode.removeChild(t)}function o(e,o,r){let i=function(e,n){const o=document.createElement("div");function r(e){if(!o.parentNode)return t.off(document,"mousemove",r);o.style.top=Math.max(0,e.clientY-o.offsetHeight-5)+"px",o.style.left=e.clientX+5+"px"}return o.className="CodeMirror-lint-tooltip",o.appendChild(n.cloneNode(!0)),document.body.appendChild(o),t.on(document,"mousemove",r),r(e),null!=o.style.opacity&&(o.style.opacity=1),o}(e,o);function s(){var e;t.off(r,"mouseout",s),i&&((e=i).parentNode&&(null==e.style.opacity&&n(e),e.style.opacity=0,setTimeout(function(){n(e)},600)),i=null)}const a=setInterval(function(){if(i)for(let t=r;;t=t.parentNode){if(t&&11===t.nodeType&&(t=t.host),t===document.body)return;if(!t){s();break}}if(!i)return clearInterval(a)},400);t.on(r,"mouseout",s)}function r(t,e,n){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(e){!function(t,e){const n=e.target||e.srcElement;if(!/\bCodeMirror-lint-mark-/.test(n.className))return;const r=n.getBoundingClientRect(),i=(r.left+r.right)/2,s=(r.top+r.bottom)/2,u=t.findMarksAt(t.coordsChar({left:i,top:s},"client")),l=[];for(let t=0;t<u.length;++t){const e=u[t].__annotation;e&&l.push(e)}l.length&&function(t,e){const n=e.target||e.srcElement,r=document.createDocumentFragment();for(let e=0;e<t.length;e++){let n=t[e];r.appendChild(a(n))}o(e,r,n)}(l,e)}(t,e)},this.waitingFor=0}function i(t){const n=t.state.lint;n.hasGutter&&t.clearGutter(e);for(let t=0;t<n.marked.length;++t)n.marked[t].clear();n.marked.length=0}function s(e,n,r,i){let s=document.createElement("div"),a=s;return s.className="CodeMirror-lint-marker-"+n,r&&((a=s.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),!1!==i&&t.on(a,"mouseover",function(t){o(t,e,a)}),s}function a(t){let e=t.severity;e||(e="error");const n=document.createElement("div");return n.className="CodeMirror-lint-message-"+e,void 0!==t.messageHTML?n.innerHTML=t.messageHTML:n.appendChild(document.createTextNode(t.message)),n}function u(e){const n=e.state.lint.options,o=n.options||n,r=n.getAnnotations||e.getHelper(t.Pos(0,0),"lint");if(r)if(n.async||r.async)!function(e,n,o){const r=e.state.lint;let i=++r.waitingFor;function s(){i=-1,e.off("change",s)}e.on("change",s),n(e.getValue(),function(n,o){e.off("change",s),r.waitingFor===i&&(o&&n instanceof t&&(n=o),e.operation(function(){l(e,n)}))},o,e)}(e,r,o);else{const t=r(e.getValue(),o,e);if(!t)return;t.then?t.then(function(t){e.operation(function(){l(e,t)})}):e.operation(function(){l(e,t)})}}function l(t,n){i(t);const o=t.state.lint,r=o.options,u=function(t){const e=[];for(let n=0;n<t.length;++n){const o=t[n],r=o.from.line;(e[r]||(e[r]=[])).push(o)}return e}(n);for(let n=0;n<u.length;++n){const i=u[n];if(!i)continue;let d=null;const p=o.hasGutter&&document.createDocumentFragment();for(let e=0;e<i.length;++e){let n=i[e],s=n.severity;s||(s="error"),c=s,d="error"===(l=d)?l:c,r.formatAnnotation&&(n=r.formatAnnotation(n)),o.hasGutter&&p.appendChild(a(n)),n.to&&o.marked.push(t.markText(n.from,n.to,{className:"CodeMirror-lint-mark-"+s,__annotation:n}))}o.hasGutter&&t.setGutterMarker(n,e,s(p,d,i.length>1,o.options.tooltips))}var l,c;r.onUpdateLinting&&r.onUpdateLinting(n,u,t)}function c(t){const e=t.state.lint;e&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){u(t)},e.options.delay||5e3))}t.defineOption("lint",!1,function(n,o,s){if(s&&s!==t.Init&&(i(n),!1!==n.state.lint.options.lintOnChange&&n.off("change",c),t.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),clearTimeout(n.state.lint.timeout),delete n.state.lint),o){const i=n.getOption("gutters");let s=!1;for(let t=0;t<i.length;++t)i[t]===e&&(s=!0);const l=n.state.lint=new r(n,(a=o)instanceof Function?{getAnnotations:a}:(a&&!0!==a||(a={}),a),s);!1!==l.options.lintOnChange&&n.on("change",c),!1!==l.options.tooltips&&"gutter"!==l.options.tooltips&&t.on(n.getWrapperElement(),"mouseover",l.onMouseOver),u(n)}var a}),t.defineExtension("performLint",function(){this.state.lint&&u(this)})});