var PythonTutor=function(){function e(e,t){this.defaultVisualServer=getDefaultVisualServerURL(),this.javaVisualServer="https://cscircles.cemc.uwaterloo.ca/",this.python2VisualServer=getPython2VisualServerURL(),this.problemId=e,this.code=codeEditors[e].getValue(),"plain"==t&&(t=getLanguageForProblemId(this.problemId)),"python"==t&&(t=getInginiousLanguageForProblemId(this.problemId)),this.language=t,this.input=document.getElementById("custominput-"+this.problemId).value}return e.prototype.visualize=function(){var e=this.createIFrameFromCode();this.showIFrameIntoModal(e)},e.prototype.createIFrameFromCode=function(){var e=document.createElement("iframe");return e.src=this.generateVisualizerUrl(),e.height="400px",e.width="100%",e.frameborder="0",e},e.prototype.showIFrameIntoModal=function(e){var t=document.getElementById("modal-"+this.problemId).getElementsByClassName("modal-body")[0];$(t).empty(),t.innerHTML="Plase wait while we excecute your code, this may take up to 10 seconds",t.appendChild(e)},e.prototype.generateVisualizerUrl=function(){return"java"==this.language?this.generateJavaUrl():this.generateGenericUrl()},e.prototype.generateJavaUrl=function(){var e={user_script:this.code,options:{showStringsAsValues:!0,showAllFields:!1},args:[],stdin:this.input};return this.serverResource()+window.encodeURIComponent(JSON.stringify(e))+"&cumulative=false&heapPrimitives=false&drawParentPointers=false&textReferences=false&showOnlyOutputs=false&py=3&curInstr=0&resizeContainer=true&highlightLines=true&rightStdout=true&codeDivHeight=450&codeDivWidth=500"},e.prototype.generateGenericUrl=function(){var e=window.encodeURIComponent(this.code);return this.serverResource()+e+"&mode=edit&py="+this.languageURIName()+"&codeDivHeight=450&codeDivWidth=500&rawInputLstJSON="+this.encodedInputArray()},e.prototype.serverResource=function(){return"java"==this.language?this.javaVisualServer+"java_visualize/iframe-embed.html?faking_cpp=false#data=":"python2"==this.language?this.python2VisualServer+"iframe-embed.html#code=":this.defaultVisualServer+"iframe-embed.html#code="},e.prototype.languageURIName=function(){return"javascript"==this.language?"js":"python2"==this.language?"2":"python3"==this.language?"3":this.language},e.prototype.encodedInputArray=function(){var e=this.input.split("\n");return window.encodeURIComponent(JSON.stringify(e))},e}();function visualizeCode(e,t){var n=new PythonTutor(t,e);$.post("/api/analytics/",{service:{key:"python_tutor",name:"Python tutor"},course_id:getCourseId()}),n.visualize()}function convertInginiousLanguageToLinter(e){return{java7:"java",java8:"java",js:"javascript",cpp:"cpp",cpp11:"cpp",c:"c",c11:"c",python2:"python2",python3:"python3",ruby:"ruby"}[e]}function webLinter(e,t,n,o){var r=convertInginiousLanguageToLinter(o.getOption("inginiousLanguage")),i=getLinterServerURL()+r;$.post(i,{code:e},function(e,n){var o=JSON.parse(e);t(o)})}!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.registerHelper("lint","python",webLinter),e.registerHelper("lint","text/x-java",webLinter),e.registerHelper("lint","text/x-c++src",webLinter),e.registerHelper("lint","text/x-csrc",webLinter)}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";var t="CodeMirror-lint-markers";function n(e){e.parentNode&&e.parentNode.removeChild(e)}function o(t,o,r){var i=function(t,n){var o=document.createElement("div");function r(t){if(!o.parentNode)return e.off(document,"mousemove",r);o.style.top=Math.max(0,t.clientY-o.offsetHeight-5)+"px",o.style.left=t.clientX+5+"px"}return o.className="CodeMirror-lint-tooltip",o.appendChild(n.cloneNode(!0)),document.body.appendChild(o),e.on(document,"mousemove",r),r(t),null!=o.style.opacity&&(o.style.opacity=1),o}(t,o);function a(){var t;e.off(r,"mouseout",a),i&&((t=i).parentNode&&(null==t.style.opacity&&n(t),t.style.opacity=0,setTimeout(function(){n(t)},600)),i=null)}var s=setInterval(function(){if(i)for(var e=r;;e=e.parentNode){if(e&&11==e.nodeType&&(e=e.host),e==document.body)return;if(!e){a();break}}if(!i)return clearInterval(s)},400);e.on(r,"mouseout",a)}function r(e,t,n){this.marked=[],this.options=t,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(t){!function(e,t){var n=t.target||t.srcElement;if(!/\bCodeMirror-lint-mark-/.test(n.className))return;for(var r=n.getBoundingClientRect(),i=(r.left+r.right)/2,a=(r.top+r.bottom)/2,u=e.findMarksAt(e.coordsChar({left:i,top:a},"client")),l=[],c=0;c<u.length;++c){var p=u[c].__annotation;p&&l.push(p)}l.length&&function(e,t){for(var n=t.target||t.srcElement,r=document.createDocumentFragment(),i=0;i<e.length;i++){var a=e[i];r.appendChild(s(a))}o(t,r,n)}(l,t)}(e,t)},this.waitingFor=0}function i(e){var n=e.state.lint;n.hasGutter&&e.clearGutter(t);for(var o=0;o<n.marked.length;++o)n.marked[o].clear();n.marked.length=0}function a(t,n,r,i){var a=document.createElement("div"),s=a;return a.className="CodeMirror-lint-marker-"+n,r&&((s=a.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),0!=i&&e.on(s,"mouseover",function(e){o(e,t,s)}),a}function s(e){var t=e.severity;t||(t="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message-"+t,void 0!==e.messageHTML?n.innerHTML=e.messageHTML:n.appendChild(document.createTextNode(e.message)),n}function u(t){var n=t.state.lint.options,o=n.options||n,r=n.getAnnotations||t.getHelper(e.Pos(0,0),"lint");if(r)if(n.async||r.async)!function(t,n,o){var r=t.state.lint,i=++r.waitingFor;function a(){i=-1,t.off("change",a)}t.on("change",a),n(t.getValue(),function(n,o){t.off("change",a),r.waitingFor==i&&(o&&n instanceof e&&(n=o),t.operation(function(){l(t,n)}))},o,t)}(t,r,o);else{var i=r(t.getValue(),o,t);if(!i)return;i.then?i.then(function(e){t.operation(function(){l(t,e)})}):t.operation(function(){l(t,i)})}}function l(e,n){i(e);for(var o,r,u=e.state.lint,l=u.options,c=function(e){for(var t=[],n=0;n<e.length;++n){var o=e[n],r=o.from.line;(t[r]||(t[r]=[])).push(o)}return t}(n),p=0;p<c.length;++p){var d=c[p];if(d){for(var f=null,m=u.hasGutter&&document.createDocumentFragment(),h=0;h<d.length;++h){var g=d[h],v=g.severity;v||(v="error"),r=v,f="error"==(o=f)?o:r,l.formatAnnotation&&(g=l.formatAnnotation(g)),u.hasGutter&&m.appendChild(s(g)),g.to&&u.marked.push(e.markText(g.from,g.to,{className:"CodeMirror-lint-mark-"+v,__annotation:g}))}u.hasGutter&&e.setGutterMarker(p,t,a(m,f,d.length>1,u.options.tooltips))}}l.onUpdateLinting&&l.onUpdateLinting(n,c,e)}function c(e){var t=e.state.lint;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(function(){u(e)},t.options.delay||5e3))}e.defineOption("lint",!1,function(n,o,a){if(a&&a!=e.Init&&(i(n),!1!==n.state.lint.options.lintOnChange&&n.off("change",c),e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),clearTimeout(n.state.lint.timeout),delete n.state.lint),o){for(var s=n.getOption("gutters"),l=!1,p=0;p<s.length;++p)s[p]==t&&(l=!0);var d=n.state.lint=new r(n,(f=o)instanceof Function?{getAnnotations:f}:(f&&!0!==f||(f={}),f),l);!1!==d.options.lintOnChange&&n.on("change",c),0!=d.options.tooltips&&"gutter"!=d.options.tooltips&&e.on(n.getWrapperElement(),"mouseover",d.onMouseOver),u(n)}var f}),e.defineExtension("performLint",function(){this.state.lint&&u(this)})});