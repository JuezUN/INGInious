var PythonTutor=function(){function t(t,e){this.defaultVisualServer=getDefaultVisualServerURL(),this.javaVisualServer="https://cscircles.cemc.uwaterloo.ca/",this.problemId=t,this.code=codeEditors[t].getValue(),"plain"==e&&(e=getLanguageForProblemId(this.problemId)),"python"==e&&(e=getInginiousLanguageForProblemId(this.problemId)),this.language=e,this.input=document.getElementById("custominput-"+this.problemId).value}return t.prototype.visualize=function(){var t=this.createIFrameFromCode();this.showIFrameIntoModal(t)},t.prototype.createIFrameFromCode=function(){var t=document.createElement("iframe");return t.src=this.generateVisualizerUrl(),t.height="400px",t.width="100%",t.frameborder="0",t},t.prototype.showIFrameIntoModal=function(t){var e=document.getElementById("modal-"+this.problemId).getElementsByClassName("modal-body")[0];$(e).empty(),e.innerHTML="Plase wait while we excecute your code, this may take up to 10 seconds",e.appendChild(t)},t.prototype.generateVisualizerUrl=function(){return"java"==this.language?this.generateJavaUrl():this.generateGenericUrl()},t.prototype.generateJavaUrl=function(){var t={user_script:this.code,options:{showStringsAsValues:!0,showAllFields:!1},args:[],stdin:this.input};return this.serverResource()+window.encodeURIComponent(JSON.stringify(t))+"&cumulative=false&heapPrimitives=false&drawParentPointers=false&textReferences=false&showOnlyOutputs=false&py=3&curInstr=0&resizeContainer=true&highlightLines=true&rightStdout=true&codeDivHeight=450&codeDivWidth=500"},t.prototype.generateGenericUrl=function(){var t=window.encodeURIComponent(this.code);return this.serverResource()+t+"&mode=edit&py="+this.languageURIName()+"&codeDivHeight=450&codeDivWidth=500&rawInputLstJSON="+this.encodedInputArray()},t.prototype.serverResource=function(){return"java"===this.language?this.javaVisualServer+"java_visualize/iframe-embed.html?faking_cpp=false#data=":this.defaultVisualServer+"iframe-embed.html#code="},t.prototype.languageURIName=function(){return"javascript"==this.language?"js":"python2"==this.language?"2":"python3"==this.language?"3":this.language},t.prototype.encodedInputArray=function(){var t=this.input.split("\n");return window.encodeURIComponent(JSON.stringify(t))},t}();function visualizeCode(t,e){var n=new PythonTutor(e,t);$.post("/api/analytics/",{service:{key:"python_tutor",name:"Python tutor"},course_id:getCourseId()}),n.visualize()}function convertInginiousLanguageToLinter(t){return{java7:"java",java8:"java",js:"javascript",cpp:"cpp",cpp11:"cpp",c:"c",c11:"c",python2:"python2",python3:"python3",ruby:"ruby"}[t]}function webLinter(t,e,n,o){var r=convertInginiousLanguageToLinter(o.getOption("inginiousLanguage")),s=getLinterServerURL()+r;$.post(s,{code:t},function(t,n){var o=JSON.parse(t);e(o)})}function getTaskIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-1]}function getCourseIdFromUrl(){let t=window.location.pathname.split("/");return t[t.length-2]}function displayCustomTestAlertError(t){displayTaskStudentAlertWithProblems(t,"danger")}function displayTimeOutAlert(t){displayTaskStudentAlertWithProblems(t,"warning")}function displayOverflowAlert(t){displayTaskStudentAlertWithProblems(t,"danger")}function displaySuccessAlert(t){displayTaskStudentAlertWithProblems(t,"success")}function displayCustomInputResults(t,e=null,n=null){if("status"in t&&"done"===t.status){if("result"in t){const n=t.result;if(e){const n=$("<span/>").addClass("stdout-text").text(t.stdout),o=$("<span/>").addClass("stderr-text").text(t.stderr);e.append(n),e.append(o)}"failed"===n?displayCustomTestAlertError(t):"timeout"===n?displayTimeOutAlert(t):"overflow"===n?displayOverflowAlert(t):"success"===n?displaySuccessAlert(t):displayCustomTestAlertError(t)}}else"status"in t&&"error"===t.status?(e&&e.html(n),"timeout"===t.result?(t.text="Your submission timed out.",displayTimeOutAlert(t)):displayCustomTestAlertError(t)):(e&&e.html(n),displayCustomTestAlertError({}))}function waitForCustomTest(t){setTimeout(()=>{$.get("/api/custom_input_notebook/",{custom_test_id:t}).done(e=>{"status"in(e=JSON.parse(e))&&"waiting"===e.status?(displayTaskLoadingAlert(e,null),waitForCustomTest(t)):"status"in e&&"result"in e?(displayCustomInputResults(e),unblurTaskForm()):(displayCustomTestAlertError(e),unblurTaskForm())}).fail(t=>{const e=JSON.parse(t.responseJSON||"{}");"status"in e&&"error"===e.status&&"text"in e?displayCustomTestAlertError(e):displayCustomTestAlertError({text:"An error occurred while running the custom tests. Please try again or submitting to know the results."}),unblurTaskForm()})},1e3)}function apiTestNotebookRequest(t,e){taskFormValid()&&($("html, body").animate({scrollTop:$("#task_alert").offset().top-100},200),blurTaskForm(),sendTestNotebookAnalytics(),$.ajax({url:"/api/custom_input_notebook/",method:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:t=>{"status"in(t=JSON.parse(t))&&"error"===t.status?(displayCustomTestAlertError(t),unblurTaskForm()):(displayTaskLoadingAlert(t,null),waitForCustomTest(t.custom_test_id))},error:t=>{const e=JSON.parse(t.responseJSON||"{}");"status"in e&&"error"===e.status&&"text"in e?displayCustomTestAlertError(e):displayCustomTestAlertError({text:"An error occurred while running the custom tests. The tests likely took more time than expect or check your session has not expired. Please try again or try submitting to know the results."}),unblurTaskForm()}}))}function apiCustomInputRequest(t,e){const n=$("#customoutput-"+t),o="<span class='placeholder-text'>Your output goes here</span>";if(!taskFormValid())return;blurTaskForm(),resetAlerts(),n.html("Running..."),sendCustomInputAnalytics(),$.ajax({url:"/api/custom_input/",method:"POST",dataType:"json",data:e,processData:!1,contentType:!1,success:function(t){t=JSON.parse(t),n.empty(),displayCustomInputResults(t,n,o),unblurTaskForm()},error:function(t){unblurTaskForm(),n.html(o)}})}function runCustomTest(t,e="multilang"){const n=new FormData($("form#task")[0]);n.set("submit_action","customtest"),n.set("courseid",getCourseId()),n.set("taskid",getTaskId()),"multilang"===e?apiCustomInputRequest(t,n):"Notebook"===e&&(n.set(`${t}/input`,n.getAll(`${t}/custom_tests`)),apiTestNotebookRequest(t,n))}function sendCustomInputAnalytics(){$.post("/api/analytics/",{service:{key:"custom_input",name:"Custom input"},course_id:getCourseId()})}function sendTestNotebookAnalytics(){$.post("/api/analytics/",{service:{key:"custom_input_notebook",name:"Custom input notebook"},course_id:getCourseId()})}!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.registerHelper("lint","python",webLinter),t.registerHelper("lint","text/x-java",webLinter),t.registerHelper("lint","text/x-c++src",webLinter),t.registerHelper("lint","text/x-csrc",webLinter)}),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";const e="CodeMirror-lint-markers";function n(t){t.parentNode&&t.parentNode.removeChild(t)}function o(e,o,r){let s=function(e,n){const o=document.createElement("div");function r(e){if(!o.parentNode)return t.off(document,"mousemove",r);o.style.top=Math.max(0,e.clientY-o.offsetHeight-5)+"px",o.style.left=e.clientX+5+"px"}return o.className="CodeMirror-lint-tooltip",o.appendChild(n.cloneNode(!0)),document.body.appendChild(o),t.on(document,"mousemove",r),r(e),null!=o.style.opacity&&(o.style.opacity=1),o}(e,o);function i(){var e;t.off(r,"mouseout",i),s&&((e=s).parentNode&&(null==e.style.opacity&&n(e),e.style.opacity=0,setTimeout(function(){n(e)},600)),s=null)}const a=setInterval(function(){if(s)for(let t=r;;t=t.parentNode){if(t&&11===t.nodeType&&(t=t.host),t===document.body)return;if(!t){i();break}}if(!s)return clearInterval(a)},400);t.on(r,"mouseout",i)}function r(t,e,n){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(e){!function(t,e){const n=e.target||e.srcElement;if(!/\bCodeMirror-lint-mark-/.test(n.className))return;const r=n.getBoundingClientRect(),s=(r.left+r.right)/2,i=(r.top+r.bottom)/2,u=t.findMarksAt(t.coordsChar({left:s,top:i},"client")),l=[];for(let t=0;t<u.length;++t){const e=u[t].__annotation;e&&l.push(e)}l.length&&function(t,e){const n=e.target||e.srcElement,r=document.createDocumentFragment();for(let e=0;e<t.length;e++){let n=t[e];r.appendChild(a(n))}o(e,r,n)}(l,e)}(t,e)},this.waitingFor=0}function s(t){const n=t.state.lint;n.hasGutter&&t.clearGutter(e);for(let t=0;t<n.marked.length;++t)n.marked[t].clear();n.marked.length=0}function i(e,n,r,s){let i=document.createElement("div"),a=i;return i.className="CodeMirror-lint-marker-"+n,r&&((a=i.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),!1!==s&&t.on(a,"mouseover",function(t){o(t,e,a)}),i}function a(t){let e=t.severity;e||(e="error");const n=document.createElement("div");return n.className="CodeMirror-lint-message-"+e,void 0!==t.messageHTML?n.innerHTML=t.messageHTML:n.appendChild(document.createTextNode(t.message)),n}function u(e){const n=e.state.lint.options,o=n.options||n,r=n.getAnnotations||e.getHelper(t.Pos(0,0),"lint");if(r)if(n.async||r.async)!function(e,n,o){const r=e.state.lint;let s=++r.waitingFor;function i(){s=-1,e.off("change",i)}e.on("change",i),n(e.getValue(),function(n,o){e.off("change",i),r.waitingFor===s&&(o&&n instanceof t&&(n=o),e.operation(function(){l(e,n)}))},o,e)}(e,r,o);else{const t=r(e.getValue(),o,e);if(!t)return;t.then?t.then(function(t){e.operation(function(){l(e,t)})}):e.operation(function(){l(e,t)})}}function l(t,n){s(t);const o=t.state.lint,r=o.options,u=function(t){const e=[];for(let n=0;n<t.length;++n){const o=t[n],r=o.from.line;(e[r]||(e[r]=[])).push(o)}return e}(n);for(let n=0;n<u.length;++n){const s=u[n];if(!s)continue;let p=null;const d=o.hasGutter&&document.createDocumentFragment();for(let e=0;e<s.length;++e){let n=s[e],i=n.severity;i||(i="error"),c=i,p="error"===(l=p)?l:c,r.formatAnnotation&&(n=r.formatAnnotation(n)),o.hasGutter&&d.appendChild(a(n)),n.to&&o.marked.push(t.markText(n.from,n.to,{className:"CodeMirror-lint-mark-"+i,__annotation:n}))}o.hasGutter&&t.setGutterMarker(n,e,i(d,p,s.length>1,o.options.tooltips))}var l,c;r.onUpdateLinting&&r.onUpdateLinting(n,u,t)}function c(t){const e=t.state.lint;e&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){u(t)},e.options.delay||5e3))}t.defineOption("lint",!1,function(n,o,i){if(i&&i!==t.Init&&(s(n),!1!==n.state.lint.options.lintOnChange&&n.off("change",c),t.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),clearTimeout(n.state.lint.timeout),delete n.state.lint),o){const s=n.getOption("gutters");let i=!1;for(let t=0;t<s.length;++t)s[t]===e&&(i=!0);const l=n.state.lint=new r(n,(a=o)instanceof Function?{getAnnotations:a}:(a&&!0!==a||(a={}),a),i);!1!==l.options.lintOnChange&&n.on("change",c),!1!==l.options.tooltips&&"gutter"!==l.options.tooltips&&t.on(n.getWrapperElement(),"mouseover",l.onMouseOver),u(n)}var a}),t.defineExtension("performLint",function(){this.state.lint&&u(this)})}),$(document).ready(function(){let t=null;$("#select_test").change(function(e){$(this).val().length>3?$(this).val(t):t=$(this).val()})});