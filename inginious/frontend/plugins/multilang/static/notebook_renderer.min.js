(function(){var t=this,e=t.document;if(!e){var r=require("jsdom");e=(new r.JSDOM).window.document}var n,i=function(t){return t},a=function(t,r){var n=e.createElement(t);return n.className=(r||[]).map(function(t){return u.prefix+t}).join(" "),n},s=function(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")},l=function(t){return t.join?t.map(l).join(""):t},p=function(t){return"function"==typeof require&&require(t)},u={prefix:"nb-",markdown:t.marked||p("marked")||i,ansi:(n=t.ansi_up||p("ansi_up"),n&&n.ansi_to_html||i),highlighter:i,VERSION:"0.4.2"};u.Input=function(t,e){this.raw=t,this.cell=e},u.Input.prototype.render=function(){if(!this.raw.length)return a("div");var t=a("div",["input"]),e=this.cell;"number"==typeof e.number&&t.setAttribute("data-prompt-number",this.cell.number);var r=a("pre"),n=a("code"),i=e.worksheet.notebook.metadata,p=this.cell.raw.language||i.language||i.kernelspec&&i.kernelspec.language||i.language_info&&i.language_info.name;return n.setAttribute("data-language",p),n.className="lang-"+p,n.innerHTML=u.highlighter(s(l(this.raw)),r,n,p),r.appendChild(n),t.appendChild(r),this.el=t,t};var o=function(t){return function(e){var r=a("img",["image-output"]);return r.src="data:image/"+t+";base64,"+l(e).replace(/\n/g,""),r}};u.display={},u.display.text=function(t){var e=a("pre",["text-output"]);return e.innerHTML=s(l(t)),e},u.display["text/plain"]=u.display.text,u.display.html=function(t){var e=a("div",["html-output"]);return e.innerHTML=l(t),e},u.display["text/html"]=u.display.html,u.display.marked=function(t){return u.display.html(u.markdown(l(t)))},u.display["text/markdown"]=u.display.marked,u.display.svg=function(t){var e=a("div",["svg-output"]);return e.innerHTML=l(t),e},u.display["text/svg+xml"]=u.display.svg,u.display["image/svg+xml"]=u.display.svg,u.display.latex=function(t){var e=a("div",["latex-output"]);return e.innerHTML=l(t),e},u.display["text/latex"]=u.display.latex,u.display.javascript=function(t){var e=a("script");return e.innerHTML=l(t),e},u.display["application/javascript"]=u.display.javascript,u.display.png=o("png"),u.display["image/png"]=u.display.png,u.display.jpeg=o("jpeg"),u.display["image/jpeg"]=u.display.jpeg,u.display_priority=["png","image/png","jpeg","image/jpeg","svg","image/svg+xml","text/svg+xml","html","text/html","text/markdown","latex","text/latex","javascript","application/javascript","text","text/plain"];var d=function(){var t=this,e=u.display_priority.filter(function(e){return t.raw.data?t.raw.data[e]:t.raw[e]})[0];return e&&u.display[e]?u.display[e](t.raw[e]||t.raw.data[e]):a("div",["empty-output"])},c=function(){var t=a("pre",["pyerr"]),e=this.raw.traceback.join("\n");return t.innerHTML=u.highlighter(u.ansi(s(e)),t),t};u.Output=function(t,e){this.raw=t,this.cell=e,this.type=t.output_type},u.Output.prototype.renderers={display_data:d,execute_result:d,pyout:d,pyerr:c,error:c,stream:function(){var t=a("pre",[this.raw.stream||this.raw.name]),e=l(this.raw.text);return t.innerHTML=u.highlighter(u.ansi(s(e)),t),t}},u.Output.prototype.render=function(){var t=a("div",["output"]);"number"==typeof this.cell.number&&t.setAttribute("data-prompt-number",this.cell.number);var e=this.renderers[this.type].call(this);return t.appendChild(e),this.el=t,t},u.coalesceStreams=function(t){if(!t.length)return t;var e=t[0],r=[e];return t.slice(1).forEach(function(t){"stream"===t.raw.output_type&&"stream"===e.raw.output_type&&t.raw.stream===e.raw.stream?e.raw.text=e.raw.text.concat(t.raw.text):(r.push(t),e=t)}),r},u.Cell=function(t,e){var r=this;if(r.raw=t,r.worksheet=e,r.type=t.cell_type,"code"===r.type){r.number=t.prompt_number>-1?t.prompt_number:t.execution_count;var n=t.input||[t.source];r.input=new u.Input(n,r);var i=(r.raw.outputs||[]).map(function(t){return new u.Output(t,r)});r.outputs=u.coalesceStreams(i)}},u.Cell.prototype.renderers={markdown:function(){var e=a("div",["cell","markdown-cell"]);return e.innerHTML=u.markdown.marked(l(this.raw.source)),null!=t.renderMathInElement&&t.renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}]}),e},heading:function(){var t=a("h"+this.raw.level,["cell","heading-cell"]);return t.innerHTML=l(this.raw.source),t},raw:function(){var t=a("div",["cell","raw-cell"]);return t.innerHTML=l(this.raw.source),t},code:function(){var t=a("div",["cell","code-cell"]);t.appendChild(this.input.render());this.outputs.forEach(function(e){t.appendChild(e.render())});return t}},u.Cell.prototype.render=function(){var t=this.renderers[this.type].call(this);return this.el=t,t},u.Worksheet=function(t,e){var r=this;this.raw=t,this.notebook=e,this.cells=t.cells.map(function(t){return new u.Cell(t,r)}),this.render=function(){var t=a("div",["worksheet"]);return r.cells.forEach(function(e){t.appendChild(e.render())}),this.el=t,t}},u.Notebook=function(t,e){var r=this;this.raw=t,this.config=e;var n=this.metadata=t.metadata||{};this.title=n.title||n.name;var i=t.worksheets||[{cells:t.cells}];this.worksheets=i.map(function(t){return new u.Worksheet(t,r)}),this.sheet=this.worksheets[0]},u.Notebook.prototype.render=function(){var t=a("div",["notebook"]);return this.worksheets.forEach(function(e){t.appendChild(e.render())}),this.el=t,t},u.parse=function(t,e){return new u.Notebook(t,e)},"function"==typeof define&&define.amd&&define(function(){return u}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.nb=u):t.nb=u}).call(this);