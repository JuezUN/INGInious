const USER_INFORMATION_TABLE_ID="userInformation",USER_TOTAL_TABLE_ID="userInformationFoot";function requestUserData(e){function n(e,n){$(`#${e}`).val(n)}$.get("/api/user_management",{username:e},function(e){configElements(),getCurrentValues(e),updateSubmissionStatus(),timeInterval=openTimeInterval(),showUserSettings(),n(NEW_USERNAME_INPUT_ID,currentUsername),n(NEW_NAME_INPUT_ID,currentName),n(NEW_EMAIL_INPUT_ID,currentEmail),fillUserTable(e.count),alertForUnknownCollections(e.unknown_collections)})}function showUserSettings(){$(`#${USER_SETTINGS_ID}`).show()}function hideUserSettings(){$(`#${USER_SETTINGS_ID}`).hide()}function getCurrentValues(e){currentEmail=e.email,currentName=e.name,currentUsername=e.username,currentCollectionList=Object.keys(Object.fromEntries(Object.entries(e.count).filter(([e,n])=>n>0)))}function fillUserTable(e){function n(e,n){return`<tr><td><h5><b>${e}</b></h5></td><td><h5>${n}</h5></td></tr>`}let t=0;for(const[r,a]of Object.entries(e))t+=a,$(`#${USER_INFORMATION_TABLE_ID}`).append(n(r,a));$(`#${USER_TOTAL_TABLE_ID}`).append(n("Total",t))}function allowEdit(){$(".edit").on("click",function(){const e=$(this).attr("data-action"),n=$(e),t=n.prop("readonly");n.prop("readonly",!t),t&&n.trigger("focus")})}function checkEmailFormat(e){return/^[^@]+@[^@]+\.[A-Z0-9._-]/i.test(e)}function checkEmailInput(){const e=$(`#${NEW_EMAIL_INPUT_ID}`);if(removeErrorStyle(e),hasEmailChanged())return!!checkEmailFormat(e.val())||(addErrorStyle(e,emailFormatError),!1)}function checkUsername(){const e=$(`#${NEW_USERNAME_INPUT_ID}`);return removeErrorStyle(e),!!hasUsernameChanged()&&(!!checkTextLen(e.val(),4)||(addErrorStyle(e,inputLenError),!1))}function checkName(){const e=$(`#${NEW_NAME_INPUT_ID}`);return removeErrorStyle(e),!!hasNameChanged()&&(!!checkTextLen(e.val(),1)||(addErrorStyle(e,inputLenError),!1))}function hasUsernameChanged(){return $(`#${NEW_USERNAME_INPUT_ID}`).val()!==currentUsername}function hasNameChanged(){return $(`#${NEW_NAME_INPUT_ID}`).val()!==currentName}function hasEmailChanged(){return $(`#${NEW_EMAIL_INPUT_ID}`).val()!==currentEmail}function getInputValue(e){return $(`#${e}`).val()}function cleanUserInfoTable(){$(`#${USER_INFORMATION_TABLE_ID}`).empty(),$(`#${USER_TOTAL_TABLE_ID}`).empty()}function alertForUnknownCollections(e){e.length&&new MessageBox(NOTIFICATIONS_ID,`${unknownCollectionsMessage}: ${e}. ${pleaseCheck}`,"warning",!1)}const USER_LIST_DIV_ID="listOfUsers",USER_TABLE_ID="userList",FIELD_OPTION_ID="fieldOption",SEARCH_BTN_ID="searchBtn";function addSearchBtnListener(){$(`#${SEARCH_BTN_ID}`).on("click",function(){if(checkSearchInput()){const e=$(`#${FIELD_OPTION_ID}`).val(),n=getSearchParameter();$.get("/api/find_user",{user:n,field:e},function(e){_updateUserTable(e),cleanNotifications()})}else new MessageBox(NOTIFICATIONS_ID,inputGeneralError,"danger",!1)})}function configUserTable(){cleanUserTable(),hideUserTableDiv()}function showUserTableDiv(){$(`#${USER_LIST_DIV_ID}`).show()}function hideUserTableDiv(){$(`#${USER_LIST_DIV_ID}`).hide()}function _updateUserTable(e){const n=e.users;configUserTable(),n.length?_appendUsersToTable(n):_appendNoUserMessage(),showUserTableDiv()}function cleanUserTable(){$(`#${USER_TABLE_ID}`).empty()}function _appendUsersToTable(e){const n=$(`#${USER_TABLE_ID}`);$.each(e,(e,t)=>{n.append(_createUserItem(t))})}function _createUserItem(e){const n=e.username;return`<tr class="itemSelection" onclick='requestUserData("${n}")'><td>${n}</td><td>${e.email}</td><td>${e.realname}</td></tr>`}function _appendNoUserMessage(){const e=`<tr><td colspan="3" class="text-center"><h4>${noUser}</h4></td></tr>`;$(`#${USER_TABLE_ID}`).append(e)}function checkSearchInput(){const e=$(`#${USERNAME_OR_EMAIL_INPUT_ID}`);return removeErrorStyle(e),!!checkTextLen(e.val(),4)||(addErrorStyle(e,inputLenError),!1)}function getSearchParameter(){return $(`#${USERNAME_OR_EMAIL_INPUT_ID}`).val()}const UPDATE_BTN_ID="updateBtn",UPDATE_CONFIRM_ID="updateDataConfirmBtn",MODAL_ID="uploadModal",PARAMETERS_LIST_ID="listParametersChanged",USERNAME_TEXT_ID="usernameToConfirm",CONFIRMATION_INPUT_ID="usernameInputConfirmation";let requestToUpdate={};function addListenerUpdateBtn(){$(`#${UPDATE_BTN_ID}`).off("click").on("click",function(){var e;requestToUpdate=validateInputs(),e=requestToUpdate,0!==Object.keys(e).length?(configModal(),confirmListener()):new MessageBox(NOTIFICATIONS_ID,inputGeneralError,"danger",!1)})}function configModal(){$(`#${MODAL_ID}`).modal("show"),$(`#${USERNAME_TEXT_ID}`).html(currentUsername),$(`#${CONFIRMATION_INPUT_ID}`).val("")}function confirmListener(){function e(e){let n="";for(const[t,r]of Object.entries(e))n+=`<li><b>${wordsDictionary[t]}:</b> ${r}</li>`;return`<ul class="normalList">${n}</ul>`}$(`#${UPDATE_CONFIRM_ID}`).off("click").on("click",function(){requestToUpdate.username=currentUsername,checkConfirmationInput()&&(hideModal(),configElements(),$.post("/api/user_management",requestToUpdate,function(n){const t=`<strong>${successMessage}:</strong> ${e(n)}`;new MessageBox(NOTIFICATIONS_ID,t,"success",!1)}).fail((n,t,r)=>{const a=JSON.parse(n.responseText),s=`<strong>${errorText}:</strong> ${e(a)}`;new MessageBox(NOTIFICATIONS_ID,s,"danger",!1)}))})}function checkConfirmationInput(){const e=$(`#${CONFIRMATION_INPUT_ID}`);return removeErrorStyle(e),e.val()===currentUsername||(addErrorStyle(e,usernameMatchError),!1)}function createListElement(e){return`<li><b>${e}</b></li>`}function addListElement(e){$(`#${PARAMETERS_LIST_ID}`).append(e)}function validateInputs(){return requestToUpdate={},cleanList(),checkUsername()&&(requestToUpdate.new_username=getInputValue(NEW_USERNAME_INPUT_ID),requestToUpdate.collection_list=JSON.stringify(currentCollectionList),addListElement(createListElement(wordsDictionary.username))),checkName()&&(requestToUpdate.name=getInputValue(NEW_NAME_INPUT_ID),addListElement(createListElement(wordsDictionary.name))),checkEmailInput()&&(requestToUpdate.email=getInputValue(NEW_EMAIL_INPUT_ID),addListElement(createListElement(wordsDictionary.email))),requestToUpdate}function cleanList(){$(`#${PARAMETERS_LIST_ID}`).empty()}function hideModal(){$(`#${MODAL_ID}`).modal("hide")}const USER_SESSIONS_BADGE_ID="userConnection",SUBMISSIONS_TABLE_ID="userSubmissions";function updateSubmissionStatus(){$.ajax({data:{username:currentUsername},type:"GET",url:"/api/user_status",success:function(e){_updateSubmissionTable(e),_updateBadge(e.num_connections)},beforeSend(e,n){}})}function _updateSubmissionTable(e){const n=e.submissions,t=e.custom_test;cleanSubmissionsTable(),n.length||t.length?(_appendSubmissionsToTable("Submission",n),_appendSubmissionsToTable("Custom Test",t)):_appendNoSubmissionsMessage()}function _updateBadge(e){const n=$(`#${USER_SESSIONS_BADGE_ID}`);function t(){"label-danger label-success".split(" ").forEach(function(e){n.toggleClass(e)})}n.hasClass("label-success")&&t(),n.text(""),n.text(e),e>0&&t()}function _appendSubmissionsToTable(e,n){const t=$(`#${SUBMISSIONS_TABLE_ID}`);$.each(n,(n,r)=>{t.append(_createSubmissionItem(e,r))})}function _createSubmissionItem(e,n){return`<tr><td>${e}</td><td>${n.courseid}</td><td>${n.taskid}</td><td>${n.submitted_on}</td></tr>`}function _appendNoSubmissionsMessage(){const e=`<tr><td colspan="4" class="text-center"><h4>${noSubmissions}</h4></td></tr>`;$(`#${SUBMISSIONS_TABLE_ID}`).append(e)}function cleanSubmissionsTable(){$(`#${SUBMISSIONS_TABLE_ID}`).empty()}function openTimeInterval(){return setInterval(updateSubmissionStatus,3e3)}function closeInterval(){clearInterval(timeInterval)}const NEW_USERNAME_INPUT_ID="newUsernameInput",NEW_NAME_INPUT_ID="newNameInput",NEW_EMAIL_INPUT_ID="newEmailInput",USERNAME_OR_EMAIL_INPUT_ID="usernameOrEmailInput",USER_SETTINGS_ID="userSettings",NOTIFICATIONS_ID="notificationsDiv";let timeInterval,currentEmail="",currentName="",currentUsername="",currentCollectionList=[];function addEvents(){allowEdit(),addSearchBtnListener(),addListenerUpdateBtn(),ajaxSetup()}function ajaxSetup(){$.ajaxSetup({beforeSend:function(){new MessageBox(NOTIFICATIONS_ID,"Loading...","info",!1)}})}function cleanNotifications(){$(`#${NOTIFICATIONS_ID}`).empty()}function configElements(){$(".edit").each(function(e,n){const t=$($(n).attr("data-action"));t.prop("readonly",!0),t.attr("value","")}),cleanUserInfoTable(),hideUserSettings(),cleanCurrentValues(),closeInterval(),cleanNotifications(),configUserTable()}function cleanCurrentValues(){currentEmail="",currentName="",currentUsername="",currentCollectionList=[]}function removeErrorStyle(e){const n=e.parent();n.removeClass("has-error"),n.find("span").remove()}function checkTextLen(e,n){return e.length>=n}function addErrorStyle(e,n){const t=e.parent();t.addClass("has-error"),t.append(`<span class="help-block">${n}</span>`)}$(function(){configElements(),addEvents()});